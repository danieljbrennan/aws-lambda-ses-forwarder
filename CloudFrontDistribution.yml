Type: AWS::CloudFront::Distribution
Properties:
  DistributionConfig:
    CNAMEs:
      - ${param:domain}
    Aliases:
      - ${param:domain}
    Origins:
      - Id: ApiGateway
        DomainName: !Join
          - "."
          - - !Ref HttpApi
            - execute-api
            - !Ref AWS::Region
            - !Ref AWS::URLSuffix
        CustomOriginConfig:
          HTTPPort: '80'
          HTTPSPort: '443'
          OriginProtocolPolicy: https-only
          OriginSSLProtocols: [ "TLSv1.2" ]
    Enabled: true
#    HttpVersion: http2
    Comment: CDN for API gateway
    PriceClass: PriceClass_All
    DefaultCacheBehavior:
      AllowedMethods:
        - DELETE
        - GET
        - HEAD
        - OPTIONS
        - PATCH
        - POST
        - PUT
      CachedMethods:
        - HEAD
        - GET
      ForwardedValues:
        QueryString: true
        Headers: [ ]
        Cookies:
          Forward: all
      MinTTL: '0'
      DefaultTTL: '0'
      TargetOriginId: ApiGateway
      ViewerProtocolPolicy: redirect-to-https
    CustomErrorResponses: [ ]
    ViewerCertificate:
      AcmCertificateArn: !ImportValue Resources:Certificate
      SslSupportMethod: sni-only
      MinimumProtocolVersion: TLSv1.2_2021
    Logging:
      IncludeCookies: 'false'
      Bucket: ''
      Prefix: ''
